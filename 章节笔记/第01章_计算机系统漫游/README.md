# 第1章：计算机系统漫游

## 1. 章节概述

本章是对整个计算机系统的概览，通过跟踪 "hello world" 程序的生命周期，介绍了计算机系统的主要组成部分和抽象层次。

## 2. 核心知识点

### 2.1 信息就是位+上下文

- 所有信息在计算机中都以位（比特）序列存储
- 同样的比特序列在不同上下文中有不同的解释方式
- 了解不同数据的编码规则至关重要

### 2.2 程序被其他程序翻译成不同的格式

源代码经过以下阶段转变为可执行程序：
- 预处理阶段：处理宏定义和头文件包含（.c → .i）
- 编译阶段：将预处理后的代码转换为汇编代码（.i → .s）
- 汇编阶段：将汇编代码转换为机器码（.s → .o）
- 链接阶段：将多个目标文件和库文件组合成可执行文件

### 2.3 了解编译系统如何工作是大有益处的

理解编译系统的工作原理有助于：
- 优化程序性能
- 理解链接时错误
- 避免安全漏洞
- 理解不同语言特性的实现

### 2.4 处理器读并解释存储在内存中的指令

- CPU 执行指令的基本循环：取指、译码、执行、访存、写回
- 系统总线连接 CPU 和内存
- I/O 设备通过控制器或适配器与系统总线相连

### 2.5 高速缓存至关重要

- 高速缓存作为内存和 CPU 之间的缓冲
- 局部性原理：程序倾向于访问最近使用过的数据或附近的数据
- 高速缓存层次结构：L1、L2、L3 缓存

### 2.6 存储设备形成层次结构

从上至下，速度降低，容量增加：
- 寄存器
- 高速缓存（L1、L2、L3）
- 主存（DRAM）
- 本地二级存储（SSD、HDD）
- 远程存储（分布式文件系统、Web服务器）

### 2.7 操作系统管理硬件

操作系统的主要功能：
- 防止硬件被失控的应用程序滥用
- 向应用程序提供简单统一的机制来控制复杂而又通常不同的低级硬件设备

操作系统的抽象概念：
- 文件：对 I/O 设备的抽象
- 虚拟内存：对主存和磁盘的抽象
- 进程：对处理器、主存和 I/O 设备的抽象
- 虚拟机：对整个计算机的抽象

### 2.8 系统之间利用网络通信

- 网络可以视为一种 I/O 设备
- 通过网络，一个系统可以访问另一个系统的文件

### 2.9 重要主题

- **并发与并行**：同时有多个活动的系统设计
- **计算机系统中抽象的重要性**：通过抽象隐藏复杂性

## 3. 代码示例

### hello.c - 经典的 Hello World 程序

```c
#include <stdio.h>

int main() {
    printf("hello, world\n");
    return 0;
}
```

### 编译过程演示：

```bash
# 预处理
gcc -E hello.c -o hello.i

# 编译
gcc -S hello.i -o hello.s

# 汇编
gcc -c hello.s -o hello.o

# 链接
gcc hello.o -o hello
```

## 4. 关键练习题

1. 解释为什么同样的位序列在不同上下文中有不同的含义。
2. 描述程序从源代码到执行的完整过程。
3. 解释处理器如何执行指令的基本循环。
4. 说明高速缓存和存储器层次结构的重要性。
5. 分析操作系统提供的主要抽象，并解释它们的作用。

## 5. 进一步阅读资料

- [深入理解计算机系统官方网站](http://csapp.cs.cmu.edu/)
- [CMU 15-213 课程视频](https://www.cs.cmu.edu/~213/)
- [The C Programming Language (K&R)](https://en.wikipedia.org/wiki/The_C_Programming_Language)

## 6. 常见问题解答

1. **为什么需要了解计算机系统？**
   - 了解计算机系统可以帮助我们编写更高效、更可靠的程序，并且更容易理解和解决程序中的问题。

2. **编译器和解释器有什么区别？**
   - 编译器将整个源代码一次性转换为机器码，然后执行；解释器则是逐行解释并执行代码。

3. **为什么要将编译过程分为多个阶段？**
   - 分阶段编译使得编译过程更加模块化、灵活，便于优化和调试。
